data:
  AzureWebJobsStorage: <>
  AzureWebJobsServiceBus__credential: <>
  AzureWebJobsServiceBus__fullyQualifiedNamespace: <>
  AzureWebJobsServiceBus__clientId: <>
  FUNCTIONS_WORKER_RUNTIME: <>
apiVersion: v1
kind: Secret
metadata:
  name: kedafuncproj
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kedafuncproj
  labels:
    app: kedafuncproj
spec:
  selector:
    matchLabels:
      app: kedafuncproj
  template:
    metadata:
      labels:
        app: kedafuncproj
        azure.workload.identity/use: "true"
    spec:
      serviceAccountName: workload-identity-sa
      containers:
      - name: kedafuncproj
        image: <>
        env:
        - name: AzureFunctionsJobHost__functions__0
          value: ServiceBusFunc
        envFrom:
        - secretRef:
            name: kedafuncproj 
        readinessProbe:
          failureThreshold: 3
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 240
          httpGet:
            path: /
            port: 80
            scheme: HTTP
        startupProbe:
          failureThreshold: 3
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 240
          httpGet:
            path: /
            port: 80
            scheme: HTTP
---
apiVersion: keda.sh/v1alpha1
kind: TriggerAuthentication
metadata:
  name: kedafuncsbtrigauth
  namespace: default # must be same namespace as the ScaledObject
spec:
  podIdentity:
      provider:  azure-workload  # Optional. Default: none
      identityId: <>
---      
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: kedafuncproj
  labels: {}
spec:
  scaleTargetRef:
    name: kedafuncproj
  triggers:
  - type: azure-servicebus
    metadata:
      direction: In
      queueName: upper-case
      namespace: kedafuncsb
      cardinality: One
    authenticationRef:
      name: kedafuncsbtrigauth  
---

